{% extends 'base.html' %}

{% block content %}
<div class="container-fluid" id="myDiv">
    <div class="row justify-content-center rounded-4 form-div-color my-5">
<div class="container-fluid">
    <h1 class="py-2 text-center">Výsledky pro faktura čslo {{ invoice.id }}</h1> <br>
        <h3 class="py-2 text-center">{{ invoice.nazev_faktury }}</h3>

    <div class="row">
   <div class="col-md-12">
        <h4 class="py-2">Data z JSON</h4>
        <!-- Tlačítko pro zobrazení/skrytí JSON -->
        <button id="toggleJsonButton" class="submit-invoice-button mb-5">Zobrazit JSON</button>

        <!-- Div pro JSON data -->
        <div id="jsonData">
            <pre>{{ result | tojson(indent=2) | safe }}</pre>
        </div>
    </div>

    <script>
        // JavaScript pro přepínání viditelnosti JSON data
        document.getElementById('toggleJsonButton').addEventListener('click', function() {
            var jsonDataDiv = document.getElementById('jsonData');
            var button = document.getElementById('toggleJsonButton');

            if (jsonDataDiv.style.display === 'none') {
                jsonDataDiv.style.display = 'block';
                button.textContent = 'Skrýt JSON'; // Změna textu tlačítka
            } else {
                jsonDataDiv.style.display = 'none';
                button.textContent = 'Zobrazit JSON'; // Změna textu tlačítka
            }
        });
    </script>

        <div class="col-md-6">
    <h2>Vytěžené údaje z faktury</h2>
    </div>
                <div class="col-md-6">
            <h2>Skutečné údaje na faktuře </h2>
    </div>
<div class="col-md-8">
    <dl class="row">
{% for key, description in key_descriptions.items() %}
            {% set value = json_data.get(key, None) %}
            {% if key not in ['VAT_RATE', 'PRICE_INCLUDING_VAT', 'PRICE_WITHOUT_VAT', 'VAT_AMOUNT'] %}
                <dt class="col-sm-4">{{ description }}</dt>
                <dd class="col-sm-8 text-truncate" style="max-width: 100%;">{{ value if value is not none else 'null' }}</dd>
            {% endif %}
        {% endfor %}

        {% if 'VAT_TABLE' in json_data %}
            {% for vat_entry in json_data['VAT_TABLE'] %}
                <dt class="col-sm-4">{{ key_descriptions['VAT_RATE'] }}</dt>
                <dd class="col-sm-8">{{ vat_entry['VAT_RATE'] }}</dd>

                <dt class="col-sm-4">{{ key_descriptions['PRICE_INCLUDING_VAT'] }}</dt>
                <dd class="col-sm-8">{{ vat_entry['PRICE_INCLUDING_VAT'] }}</dd>

                <dt class="col-sm-4">{{ key_descriptions['PRICE_WITHOUT_VAT'] }}</dt>
                <dd class="col-sm-8">{{ vat_entry['PRICE_WITHOUT_VAT'] }}</dd>

                <dt class="col-sm-4">{{ key_descriptions['VAT_AMOUNT'] }}</dt>
                <dd class="col-sm-8">{{ vat_entry['VAT_AMOUNT'] }}</dd>
            {% endfor %}
        {% endif %}
    </dl>
</div>
        <div class="col-md-4">



<dl class="row">
        <dd>{{ invoice.evidencni_cislo if invoice.evidencni_cislo else 'null' }}</dd>

        <dd>{{ invoice.typ_faktury if invoice.typ_faktury else 'null' }}</dd>

        <dd class="text-truncate" style="max-width: 100%;">{{ invoice.adresa_dodavatele if invoice.adresa_dodavatele else 'null' }}</dd>

        <dd class="text-truncate" style="max-width: 100%;">{{ invoice.jmeno_dodavatele if invoice.jmeno_dodavatele else 'null' }}</dd>

        <dd>{{ invoice.ico_dodavatele if invoice.ico_dodavatele else 'null' }}</dd>

        <dd>{{ invoice.dic_dodavatele if invoice.dic_dodavatele else 'null' }}</dd>

        <dd>{{ invoice.cislo_uctu if invoice.cislo_uctu else 'null' }}</dd>

        <dd>{{ invoice.variabilni_symbol if invoice.variabilni_symbol else 'null' }}</dd>

        <dd>{{ invoice.datum_vystaveni if invoice.datum_vystaveni else 'null' }}</dd>

        <dd>{{ invoice.datum_uzp if invoice.datum_uzp else 'null' }}</dd>

        <dd>{{ invoice.datum_splatnosti if invoice.datum_splatnosti else 'null' }}</dd>

        <dd>{{ invoice.platebni_metoda if invoice.platebni_metoda else 'null' }}</dd>

        <dd>{{ invoice.mena if invoice.mena else 'null' }}</dd>

        <dd>{{ invoice.rpdp if invoice.rpdp else 'null' }}</dd>

        <dd>{{ invoice.zaokrouhleni if invoice.zaokrouhleni else 'null' }}</dd>

        {% if invoice.vc_dph_21 or invoice.bez_dph_21 or invoice.dph_21 %}
            <dd> 21 %</dd>  <!-- Prázdné pole se zobrazí pouze, pokud alespoň jedna z položek není prázdná -->
            <dd>{{ invoice.vc_dph_21 }}</dd>
            <dd>{{ invoice.bez_dph_21 }}</dd>
            <dd>{{ invoice.dph_21 }}</dd>
        {% endif %}

        {% if invoice.vc_dph_12 or invoice.bez_dph_12 or invoice.dph_12 %}
            <dd>12 %</dd>  <!-- Prázdné pole se zobrazí pouze, pokud alespoň jedna z položek není prázdná -->
            <dd>{{ invoice.vc_dph_12 }}</dd>
            <dd>{{ invoice.bez_dph_12 }}</dd>
            <dd>{{ invoice.dph_12 }}</dd>
        {% endif %}

        {% if invoice.bez_dph_0 %}
            <dd>0 %</dd>  <!-- Prázdné pole se zobrazí pouze, pokud alespoň jedna z položek není prázdná -->
            <dd>{{ invoice.bez_dph_0 }}</dd>
            <dd>{{ invoice.bez_dph_0 }}</dd>
            <dd>0</dd>
        {% endif %}
            </dl>
        </div>
    </div>


<div class="container">
    <h1 class="py-2 text-center">Porovnání hodnot</h1>
    <table class="table table-custom">
        <tbody>
            <!-- Porovnání Variabilní symbol -->
            <tr class="{% if json_data.get('VARIABLE_SYMBOL') == invoice.variabilni_symbol %}text-success{% else %}text-danger{% endif %}">
                <th class="col-sm-3">Variabilní symbol</th>
                <td class="col-sm-3">{{ invoice.variabilni_symbol }}</td>
                <td class="col-sm-3">{{ json_data.get('VARIABLE_SYMBOL', 'N/A') }}</td>
                <td class="col-sm-3">
                    {% if json_data.get('VARIABLE_SYMBOL') == invoice.variabilni_symbol %}
                        <span class="badge bg-success">TRUE</span> <!-- Zelený štítek -->
                    {% else %}
                        <span class="badge bg-danger">FALSE</span> <!-- Červený štítek -->
                    {% endif %}
                </td>
            </tr>

            <!-- Další porovnání -->
            <tr class="{% if json_data.get('IC_SUPPLIER') == invoice.ico_dodavatele %}text-success{% else %}text-danger{% endif %}">
                <th class="col-sm-3">IČ dodavatele</th>
                <td class="col-sm-3">{{ invoice.ico_dodavatele }}</td>
                <td class="col-sm-3">{{ json_data.get('IC_SUPPLIER', 'N/A') }}</td>
                <td class="col-sm-3">
                    {% if json_data.get('IC_SUPPLIER') == invoice.ico_dodavatele %}
                        <span class="badge bg-success">TRUE</span> <!-- Zelený štítek -->
                    {% else %}
                        <span class="badge bg-danger">FALSE</span> <!-- Červený štítek -->
                    {% endif %}
                </td>
            </tr>
        </tbody>
    </table>
</div>
</div>
</div>

</div>
{% endblock content %}


